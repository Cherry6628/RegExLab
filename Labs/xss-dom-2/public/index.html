<!doctype html>
<html>
<head>
    <title>Aran360 ‚Äî Search</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Product Search</h1>
            <p class="subtitle">Search our catalog below</p>
        </div>
        <div class="card">
            <div class="search-form">
                <input type="text" id="q" placeholder="Search products..." class="input" autocomplete="off"/>
                <button class="btn" onclick="doSearch()">Search</button>
            </div>
            <div id="results"></div>
        </div>
        <div id="solved-banner" class="solved-banner">
            <p>üéâ Lab Solved! XSS executed successfully.</p>
        </div>
    </div>
    <script>
        const __triggerCompletion = async () => {
            try {
                await fetch(window.location.pathname + "/xss-fired");
                const r = await fetch(window.location.pathname + "/complete", { method: "POST" });
                if (r.ok) {
                    await fetch("/lab/complete", { method: "POST" });
                    document.getElementById("solved-banner").style.display = "block";
                }
            } catch(e) {}
        };

        const __realAlert = window.alert.bind(window);
        window.alert = function(msg) { __realAlert(msg); __triggerCompletion(); };
        const __realConfirm = window.confirm.bind(window);
        window.confirm = function(msg) { __realConfirm(msg); __triggerCompletion(); };
        const __realPrint = window.print.bind(window);
        window.print = function() { __realPrint(); __triggerCompletion(); };

        function doSearch() {
            const q = document.getElementById("q").value;
            window.location.search = "?q=" + q;
        }

        document.getElementById("q").addEventListener("keypress", (e) => {
            if (e.key === "Enter") doSearch();
        });

        // vulnerability ‚Äî innerHTML with raw location.search
        // <script> won't execute via innerHTML ‚Äî must use <img src=x onerror=alert(1)>
        const params = new URLSearchParams(window.location.search);
        const q = params.get("q");
        if (q) {
            document.getElementById("q").value = q;
            document.getElementById("results").innerHTML =
                "<p class='result-text'>You searched for: " + q + "</p>" +
                "<div class='no-results'>No products found.</div>";
        }
    </script>
</body>
</html>
